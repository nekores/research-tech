language: node_js
node_js:
- '6'

before_install:
  - stty cols 80

env:
  global:
    secure: orU+oZpgaGeR1IDirCe87msd2HemNCLS+8WgcHccPxLZcc81ZACoTAUg3kA+en0xrJQ6Dm/GP3OOv2Xj30dl7ufzm6dcr0ivgkcq+p0eq38qiO0ZKlW6GwcAU1hfirU7HfRbWipIDyclzDOV5LdLFZ1C6/9BmoBb/Dbjb4dlXURW3SJ+Wl/wFqcIRpZ8gHnXDt80uBF3i+fXi4sh3QRtbUE4iIPlMVPJiOvW6poS2OF0U5fJ9DawE9fIC6jmFzfXSyaU5PLdoZWYuPnlSKQsuOGL419RW8DcmDJnf86i90BCVg1L5lIzNmPS1xYFaJoZbMY1fFeUFJ+i/nlZ+nTRW7G638C4BU7NCtgo5PzN6KbTSimLLe+0xpBRiejGllYcoARRn3PKKeyll29o65PQC690IR8hXchY725kik24RAKkfWRLhfcoV01q7NsweUW8zFvwjmZsXPvvdEDAVTYwJVw1aREMetiCzgsWFDzwEUT5D9f7I83+rfpKEzoVqgCeGUbnl2sbplwIg70pGSKq+gLHxppe5M/tLHQs37JLWML6AXt7YAXy32sNGQF4cMGF7z1Aj6Svfq3rOeZdWADl+HvQYi2GY+BbQiTpeBqobybYLcnonKccgqN4L8WAWKX35jqTcgbQx5wablkQFerzK1thg9/DkNZXHpnERr4QwrY=
dist: trusty
sudo: required
addons:
  firefox: stable
  chrome: stable

before_script:
- "export DISPLAY=:99.0"
- "sh -e /etc/init.d/xvfb start"
- sleep 3
- npm install -g concurrently@3.1.0
script:
- npm run build_knockout_dev
- npm run build_knockout_prod
- npm run build_react_dev
- npm run build_react_prod
- npm run build_angular_dev
- npm run build_angular_prod
- npm run build_jquery_dev
- npm run build_jquery_prod
- npm run build_vue_dev
- npm run build_vue_prod
- karma start --single-run
- http-server --silent &
- testcafe chrome testCafe/ --reporter minimal
#- npm run testcafe_sauce
- if [[ "$TRAVIS_EVENT_TYPE" = "cron" ]]; then echo "Starting functional tests on SauceLabs..."; npm run testcafe_sauce; fi
before_deploy: tar -zcvf surveyjs.tar.gz packages
deploy:
- provider: releases
  api_key:
    secure: D5a1NUzsPcj0LgJDfTDXhCnutWb5W14jHgqg9xbOm6nSpQXq6NWVVfuFAETR1Z7X/bv09ASMLBStWDXs0tyQh359dETB0VGtBiioN5A8elfEC/sHlNvGPGiOiiujLOfbxQF8uvcKMofgJb3LTrKxiECerjRAUn233gGBGEhfYjdFLMOUtMepdF+skqxKR8pK8eNNkFOPgpcBqu149aDBf8gXdiKh3DTCYF50lwgDOLax9V4P9BP6kR1wAZ7LJbkF+EBma4xb95czUY/e5qBlEqhHIhn56o4AhpblNXGfFAKfMIOv6KRGeJMpuQay2Y55U+Zm70iW/Rw1xL7oHvilYDYuJ9qWlv1//kI53MRgxuS/0qexFak1VbAiaAqGm9BMAjNOlG3tniMV0ksitfHHmoA8ld6fHoSFKevCE0We5w/WjtqvP3A9Fnmh9sURH3taoJnCzvxa46coDyDC84YbVzojaVHB5Jjt74y1NS9xwgTej6+FS4VfCqYHfZX5xUtZui1ENQYMysLj5dNSZVV9IlAD9YWd46T8Te0C1/Q6qgrXm7wXyQYvQXkdOnwOKhn0IWiRbBNe4UnAAaJC9YCNw0lBuziF9fMTviSHkCOm9apG/cEbC0XpzCs5hcQaLp9KVA6gIU36CuWtdPF77BjP6tmQkyeMNEYquMGcjpcB4L0=
  file:
  - surveyjs.tar.gz
  skip_cleanup: true
  on:
    tags: true
- provider: script
  script: chmod +x ./deploy_npm.sh && ./deploy_npm.sh
  skip_cleanup: true
  on:
    tags: true
notifications:
  email:
    recipients:
      - andrew.telnov@gmail.com
